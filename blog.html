<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدونة يوسف للبصريات</title>
    <meta name="description" content="مقالات ونصائح من خبراء يوسف للبصريات حول صحة العين، اختيار النظارات، وأحدث صيحات الموضة في عالم البصريات.">
    <meta name="keywords" content="صحة العين, العناية بالنظر, اختيار النظارات, عدسات طبية, نصائح بصرية">

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --y-primary: #0d0d0d;
            --y-secondary: #F2B705;
            --y-secondary-darker: #e0aa04;
            --y-light-bg: #f8fafc;
            --y-light-card: #ffffff;
            --y-light-text: #4b5563;
            --y-light-border: #e5e7eb;
            --y-dark-bg: #111827;
            --y-dark-card: #1f2937;
            --y-dark-text: #d1d5db;
            --y-dark-border: #374151;
            --y-dark-header: #9ca3af;
            --bs-font-sans-serif: 'Tajawal', sans-serif;
            --font-cairo: 'Cairo', sans-serif;
            --bs-border-radius: 0.5rem;
            --bs-border-radius-lg: 0.75rem;
            --yello: #F2B705;
            --yello-dark: #e0a800;
        }
        [data-bs-theme="dark"] {
            --bs-body-bg: var(--y-dark-bg);
            --bs-body-color: var(--y-dark-text);
            --bs-border-color: var(--y-dark-border);
            --bs-tertiary-bg: var(--y-dark-card);
            --bs-secondary-bg: var(--y-dark-card);
        }
        body {
            background-color: var(--y-light-bg);
            scroll-behavior: smooth;
            transition: background-color 0.3s ease, color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex-grow: 1;
        }
        [data-bs-theme="dark"] body {
            background-color: var(--y-dark-bg);
        }
        h1, h2, h3, h4, h5, .btn, .modal-title {
            font-family: var(--font-cairo);
            font-weight: 700;
        }
        .lead { color: var(--y-light-text); }
        [data-bs-theme="dark"] .lead { color: var(--y-dark-text); }
        a { text-decoration: none; }
        
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            direction: rtl; 
            background-color: var(--y-primary);
            color: #fff;
            padding: 0.5rem 0;
        }
        .marquee-track {
            display: flex;
            animation: marquee-ltr 30s linear infinite;
        }
        .marquee-content {
            flex: 0 0 auto;
            padding: 0 2rem;
            font-family: var(--font-cairo);
            font-weight: 500;
            font-size: 0.9rem;
        }
        .marquee-content i {
            color: var(--y-secondary);
            margin: 0 1rem;
        }
        @keyframes marquee-ltr {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .navbar {
            top: 56px;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--y-light-border);
        }
        [data-bs-theme="dark"] .navbar {
            background-color: rgba(17, 24, 39, 0.8);
            border-bottom: 1px solid var(--y-dark-border);
        }

        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(var(--bs-body-bg-rgb), 0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .loading-spinner { width: 50px; height: 50px; border: 4px solid rgba(120,120,120,0.2); border-radius: 50%; border-top-color: var(--y-secondary); animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Blog Specific Styles */
        .blog-card {
            transition: all 0.3s ease;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--y-light-border);
            background-color: var(--y-light-card);
            overflow: hidden;
        }
        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        [data-bs-theme="dark"] .blog-card {
            background-color: var(--y-dark-card);
            border-color: var(--y-dark-border);
        }
        .blog-card-img {
            height: 220px;
            object-fit: cover;
        }
        .blog-card .card-body {
            display: flex;
            flex-direction: column;
        }
        .blog-card .card-text {
            color: var(--y-light-text);
        }
        [data-bs-theme="dark"] .blog-card .card-text {
            color: var(--y-dark-text);
        }
        .blog-card .btn-read-more {
            background-color: var(--y-secondary);
            border-color: var(--y-secondary);
            color: var(--y-primary);
        }

        /* --- Footer Styles --- */
        .site-footer {
            background: linear-gradient(to right, #000, #1a1a1a);
            color: #fff;
            padding-top: 4rem;
            padding-bottom: 2rem;
            font-family: 'Tajawal', sans-serif;
        }
        .site-footer h5 { font-family: 'Cairo', sans-serif; font-weight: 700; color: #fff; margin-bottom: 1.5rem; }
        .site-footer p { color: #adb5bd; }
        .site-footer .footer-links { list-style: none; padding: 0; }
        .site-footer .footer-links li { margin-bottom: 0.75rem; }
        .site-footer .footer-links a { color: #adb5bd; text-decoration: none; transition: color 0.2s; }
        .site-footer .footer-links a:hover { color: var(--yello); }
        .site-footer .social-icon { width: 40px; height: 40px; border-radius: 50%; background-color: #343a40; display: inline-flex; align-items: center; justify-content: center; color: #fff; transition: background-color 0.2s; }
        .site-footer .social-icon:hover { background-color: var(--yello); color: #000; }
        .site-footer .footer-bottom { border-top: 1px solid #495057; padding-top: 1.5rem; margin-top: 2rem; color: #6c757d; }
        .site-footer .footer-bottom a { color: var(--yello); text-decoration: none; }
        .site-footer .footer-bottom a:hover { text-decoration: underline; }
        .site-footer .form-control { background-color: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: #fff; }
        .site-footer .form-control::placeholder { color: #adb5bd; }
        .site-footer .btn-yello { background-image: linear-gradient(to top, #f2b705, #f5c431); border: none; transition: all 0.3s ease; color: #000; font-weight: bold; }
        .site-footer .btn-yello:hover { background-color: var(--yello-dark); color: #000; }
    </style>
</head>
<body>



    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <nav class="navbar navbar-expand-lg fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="store.html">
                <img src="images/logo.png" alt="Logo" style="max-height: 50px;" onerror="this.onerror=null;this.src='https://placehold.co/150x50/0d0d0d/F2B705?text=Youssef+Optics';">
            </a>
            <div class="d-flex align-items-center">
                <button id="darkModeToggle" class="btn btn-outline-secondary me-3 border-0 fs-5">
                    <i class="fas fa-moon"></i>
                    <i class="fas fa-sun d-none"></i>
                </button>
               
            </div>
        </div>
    </nav>

    <main class="container" style="padding-top: 130px; padding-bottom: 5rem;">
        <div class="text-center mb-5">
            <h1 class="fw-bolder display-5">مدونة يوسف للبصريات</h1>
            <p class="lead text-muted mx-auto" style="max-width: 600px;">نصائح ومعلومات قيمة للحفاظ على صحة عينيك وأناقة إطلالتك</p>
        </div>

        <div id="blogPostsContainer" class="row g-4">
            <!-- Blog posts will be loaded here -->
        </div>
    </main>

    <footer class="site-footer mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 mb-4 mb-lg-0">
                    <h5>يوسف للبصريات</h5>
                    <p>حيث تلتقي الرؤية بالأناقة. نقدم أفضل الحلول البصرية مع أحدث التصاميم العالمية.</p>
                    <div class="d-flex gap-2">
                        <a href="https://www.facebook.com/share/193kMj5kWg/" target="_blank" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.instagram.com/youalhassan?igsh=N2djbHd2azV6aGJx" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="https://wa.me/201092837489" target="_blank" class="social-icon"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 mb-lg-0">
                    <h5>روابط سريعة</h5>
                    <ul class="footer-links">
                        <li><a href="index.html">الرئيسية</a></li>
                        <li><a href="store.html">المتجر</a></li>
                        <li><a href="blog.html">المدونة</a></li>
                        <li><a href="index.html#contact">اتصل بنا</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5>سياساتنا</h5>
                    <ul class="footer-links">
                        <li><a href="privacy.html">سياسة الخصوصية</a></li>
                        <li><a href="returns.html">سياسة الاستبدال والاسترجاع</a></li>
                        <li><a href="terms.html">الشروط والأحكام</a></li>
                        <li><a href="track.html">تتبع طلبك</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5>اشترك في النشرة البريدية</h5>
                    <p>اشترك لتصلك أحدث العروض والتخفيضات.</p>
                    <form>
                        <div class="input-group">
                            <input type="email" class="form-control" placeholder="بريدك الإلكتروني">
                            <button class="btn btn-yello" type="button"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="footer-bottom text-center">
                <p class="mb-0">&copy; 2025 جميع الحقوق محفوظة | يوسف للبصريات</p>
                <p class="mb-0 mt-1 small">تصميم وتطوير بواسطة <a href="https://www.facebook.com/share/19LSLJAU8J/" target="_blank">Ehab Mohamad Fkrey</a></p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAlrzDNrFGxE-tihV6cAj_6r77RcFW8FgA",
            authDomain: "youssef-optics.firebaseapp.com",
            projectId: "youssef-optics",
            storageBucket: "youssef-optics.appspot.com",
            messagingSenderId: "956537200762",
            appId: "1:956537200762:web:bfbb1ca17debc2b30a1bc3"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            
            const init = async () => {
                await loadBlogPosts();
                setupEventListeners();
                loadTheme();
                const marqueeHeight = document.querySelector('.marquee-container.fixed-top')?.offsetHeight || 0;
                document.body.style.paddingTop = `${marqueeHeight}px`;
                document.querySelector('.navbar').style.top = `${marqueeHeight}px`;
            };
            
            const loadBlogPosts = async () => {
                const container = document.getElementById('blogPostsContainer');
                const loadingOverlay = document.getElementById('loadingOverlay');
                loadingOverlay.style.display = 'flex';

                try {
                    // FIX: Fetch documents first, then sort them in JavaScript to avoid index requirement.
                    // 1. Fetch all published documents without complex ordering.
                    const postsQuery = query(collection(db, "blogPosts"), where("isPublished", "==", true));
                    const querySnapshot = await getDocs(postsQuery);
                    
                    if (querySnapshot.empty) {
                        container.innerHTML = `<div class="col-12 text-center py-5"><p class="lead">لا توجد مقالات منشورة حالياً. تابعنا للمزيد!</p></div>`;
                        return;
                    }
                    
                    // 2. Convert snapshot to a mutable array.
                    let posts = [];
                    querySnapshot.forEach((doc) => {
                        posts.push({ id: doc.id, ...doc.data() });
                    });

                    // 3. Sort the array on the client-side by date.
                    posts.sort((a, b) => {
                        const dateA = a.createdAt?.toDate() || 0;
                        const dateB = b.createdAt?.toDate() || 0;
                        return dateB - dateA; // Sorts descending (newest first)
                    });

                    // 4. Render the sorted posts.
                    posts.forEach((post) => {
                        container.appendChild(createPostCard(post));
                    });

                } catch (error) {
                    console.error("Error loading blog posts:", error);
                    container.innerHTML = `<div class="col-12 text-center py-5"><h3 class="text-danger">فشل تحميل المقالات.</h3><p class="text-muted">حدث خطأ ما، يرجى المحاولة مرة أخرى لاحقاً.</p></div>`;
                } finally {
                    loadingOverlay.style.display = 'none';
                }
            };

            const createPostCard = (post) => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';

                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = post.content || '';
                const snippet = tempDiv.textContent.substring(0, 120) + '...';

                const postDate = post.createdAt ? post.createdAt.toDate().toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' }) : 'غير محدد';

                col.innerHTML = `
                    <div class="card blog-card h-100">
                        <a href="post.html?id=${post.id}">
                            <img src="${post.imageUrl || 'https://placehold.co/600x400/eee/ccc?text=Youssef+Optics'}" class="card-img-top blog-card-img" alt="${post.title}">
                        </a>
                        <div class="card-body">
                            <h5 class="card-title fw-bold"><a href="post.html?id=${post.id}" class="text-body">${post.title}</a></h5>
                            <p class="card-text small text-muted">
                                <i class="fas fa-user-edit me-1"></i> ${post.author || 'يوسف للبصريات'} 
                                <span class="mx-2">|</span>
                                <i class="fas fa-calendar-alt me-1"></i> ${postDate}
                            </p>
                            <p class="card-text">${snippet}</p>
                            <div class="mt-auto">
                                <a href="post.html?id=${post.id}" class="btn btn-sm btn-read-more">اقرأ المزيد <i class="fas fa-arrow-left me-1"></i></a>
                            </div>
                        </div>
                    </div>
                `;
                return col;
            };

            const setupEventListeners = () => {
                document.getElementById('darkModeToggle').addEventListener('click', toggleTheme);
            };

            const loadTheme = () => {
                const theme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-bs-theme', theme);
                const toggle = document.getElementById('darkModeToggle');
                const sunIcon = toggle.querySelector('.fa-sun');
                const moonIcon = toggle.querySelector('.fa-moon');
                if (theme === 'dark') {
                    moonIcon.classList.add('d-none');
                    sunIcon.classList.remove('d-none');
                } else {
                    moonIcon.classList.remove('d-none');
                    sunIcon.classList.add('d-none');
                }
            };

            const toggleTheme = () => {
                const newTheme = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                loadTheme();
            };

            

            init();
        });
    </script>
</body>
</html>
